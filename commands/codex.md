---
description: Диалог с Codex для обсуждения и достижения консенсуса
argument-hint: [тема для обсуждения с Codex]
---

## Цель

Вести продуктивный P2P диалог с Codex до достижения консенсуса или эскалации к пользователю.

## Рабочий процесс

### 1. Начало диалога

Выполнить первый запрос через скрипт с логированием:

```bash
.claude/scripts/codex/new.sh "$ARGUMENTS"
```

Скрипт автоматически:
- Создаёт лог-файл в `.claude/logs/codex/`
- Записывает запрос и ответ
- Обновляет symlink `latest.md`

### 2. Бюджет прогресса

Вместо жёсткого лимита раундов используется **бюджет прогресса**:

- **Начальное значение:** 5
- **Нет прогресса** → бюджет **-1**
- **Есть прогресс** → бюджет **= 5** (полное восстановление)
- **Бюджет = 0** → эскалация к пользователю

**Что считается прогрессом:**
- Создан или изменён артефакт (код, план, схема)
- Получена новая информация через инструмент (поиск, чтение файла)
- Формальное принятие аргумента: **"Принимаю твой подход к [X]"**

### 3. Оценка ответа

После каждого ответа Codex задай себе вопросы:

- Согласен ли я с этим ответом?
- Есть ли логические ошибки или упущения?
- Нужно ли уточнить или оспорить что-то?
- Нужно ли проверить гипотезу через инструмент?
- **Что ценного в этом ответе?** (даже если не согласен)

### 3.1. Правило честного диалога

**Цель диалога — лучшее решение, а не победа в споре.**

- При возражении — **явно признать сильные аргументы** Codex
- Формат: "Согласен с [X], но не согласен с [Y] потому что..."
- **Красный флаг:** 3 раунда подряд только возражения без принятий → самопроверка: "Я защищаю позицию или ищу истину?"
- Если самопроверка не помогла → эскалация к пользователю

### 4. Правило синтеза

При **расхождении позиций** — обязательный шаг синтеза.

**Триггеры для синтеза:**
- **Явное несогласие** — маркеры: "не согласен", "против", "лучше сделать", "предлагаю альтернативу"
- **Конкурирующие предложения** — оба предлагают разные решения одной задачи
- **Игнорирование + контрпредложение** — нет сигнала принятия, но есть альтернатива

**НЕ триггеры (синтез не нужен):**
- Уточняющий вопрос
- Дополняющее предложение
- Последовательные шаги

**Цель синтеза:** объединить лучшее из обоих подходов или предложить третий вариант.

**Лимит:** если 2 попытки синтеза провалились → эскалация.

### 5. Проверка гипотез

При спорах о фактах — использовать инструменты для проверки:

**Формат:** "Моя гипотеза — [X]. Проверяю через [инструмент]."

Примеры:
- Спор об архитектуре → проверить код
- Спор о формулировке → поискать в документации
- Спор о возможностях → тестовый запрос

### 6. Продолжение диалога

Если есть возражения или уточнения — продолжай диалог через скрипт:

```bash
.claude/scripts/codex/continue.sh "твой контраргумент или уточнение"
```

Скрипт автоматически:
- Добавляет `--resume --last` для продолжения сессии
- Дописывает в текущий лог-файл
- Увеличивает счётчик раундов

### 7. Эскалация к пользователю

**Триггеры эскалации:**
- Бюджет прогресса = 0
- 2 провалившихся попытки синтеза
- Вопрос требует решения пользователя (предпочтения, бизнес-логика)

**Формат эскалации (через AskUserQuestion):**
1. Исходная цель
2. Позиция Claude
3. Позиция Codex
4. Точка разногласия

### 8. Отчёт пользователю

После завершения диалога предоставить:

- **Количество раундов** диалога
- Краткий итог дискуссии
- **Что Claude пересмотрел/принял** от Codex
- Финальное решение/консенсус
- Если была эскалация — изложить обе позиции для решения пользователя

## Пример использования

```
/codex оцени мой план рефакторинга компонента UserProfile
```

Claude начнёт диалог с Codex, обсудит план, при необходимости возразит или запустит синтез, и вернёт согласованный результат.
